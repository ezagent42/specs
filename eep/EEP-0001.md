# EEP-0001 â€” Bridge Extension (EXT-18)

> **EEP**: 0001
> **æ ‡é¢˜**: Bridge Extension for External Platform Interop
> **ç±»å‹**: Standards
> **çŠ¶æ€**: Draft
> **ä½œè€…**: Allen
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-28
> **å…³è” Spec ç‰ˆæœ¬**: v0.9.5
> **ç›®æ ‡ Spec ç‰ˆæœ¬**: TBDï¼ˆå»ºè®® v0.11+ / Phase 3 ä¹‹åï¼‰

---

## Abstract

æå‡º EXT-18 Bridge Extensionï¼Œä¸º ezagent æä¾›ä¸å¤–éƒ¨é€šä¿¡å¹³å°ï¼ˆSlackã€Emailã€Discordã€Mattermost ç­‰ï¼‰çš„åŒå‘æ¶ˆæ¯æ¡¥æ¥èƒ½åŠ›ã€‚Bridge åœ¨ Extension å±‚å®šä¹‰ Bridged Entity èº«ä»½æ¨¡å‹ã€æ¶ˆæ¯è·¯ç”± Hook å’Œå½’ä¸€åŒ–æ¶ˆæ¯æ ¼å¼ï¼ŒåŒæ—¶é€šè¿‡ Connector Plugin æ¥å£å°†å¹³å°ç‰¹å®šåè®®éš”ç¦»åˆ°ç‹¬ç«‹å¯æ›¿æ¢çš„ Python æ¨¡å—ä¸­ã€‚

## Motivation

### ç°çŠ¶é—®é¢˜

ezagent åè®®ç›®å‰æ²¡æœ‰ä¸å¤–éƒ¨é€šä¿¡å¹³å°äº’é€šçš„æ ‡å‡†åŒ–æœºåˆ¶ã€‚å½“ Socialwareï¼ˆå¦‚ TaskArenaï¼‰éœ€è¦å°†ä»»åŠ¡é€šçŸ¥å‘é€åˆ° Slack channelï¼Œæˆ–æ¥æ”¶æ¥è‡ª Email çš„æäº¤æ—¶ï¼Œé¢ä¸´ä»¥ä¸‹å›°å¢ƒï¼š

1. **èº«ä»½æ˜ å°„æ— åè®®å±‚æ”¯æŒ**ã€‚å¤–éƒ¨ç”¨æˆ·æ²¡æœ‰ ezagent Entity IDã€‚Architecture Â§1.4 çš„ Entity ID ä½“ç³» (`@local:relay_domain`) å®Œå…¨é¢å‘åŸç”ŸèŠ‚ç‚¹ï¼Œæ²¡æœ‰ä¸ºå¤–éƒ¨ identity æä¾›æ˜ å°„å±‚ã€‚
2. **Socialware é‡å¤é€ è½®å­**ã€‚TaskArena å’Œ ResPool å„è‡ªå¯¹æ¥ Slack æ—¶ï¼Œéƒ½è¦ç‹¬ç«‹å®ç° OAuthã€Webhook è§£æã€æ¶ˆæ¯æ ¼å¼è½¬æ¢â€”â€”è¿å "Extension åšèƒ½åŠ›ï¼ŒSocialware åšä¸šåŠ¡" çš„åˆ†å±‚å“²å­¦ã€‚
3. **æ¶ˆæ¯è¯­ä¹‰ä¸¢å¤±**ã€‚å¤–éƒ¨æ¶ˆæ¯å­˜ä¸ºæ™®é€š `immutable` æ–‡æœ¬ï¼Œä¸¢å¤±æ¥æºå…ƒä¿¡æ¯ã€‚å…¶ä»– Hook æ— æ³•åŸºäºæ¥æºåšå·®å¼‚åŒ–å¤„ç†ã€‚
4. **Hook Pipeline æ— æ³•ç»Ÿä¸€å¤„ç†å¤–éƒ¨æµé‡**ã€‚æ¡¥æ¥é€»è¾‘æ•£è½åœ¨å„ Socialware ä¸­ï¼Œpre_send é˜¶æ®µæ— æ³•ç»Ÿä¸€éªŒè¯ï¼Œafter_write é˜¶æ®µæ— æ³•ç»Ÿä¸€è·¯ç”±ã€‚

### ä¸åšä¼šæ€æ ·

çŸ­æœŸå¯è¡Œä½†é•¿æœŸä¸å¯æŒç»­ã€‚éšç€ Socialware æ•°é‡å¢é•¿å’Œå¯¹æ¥å¹³å°å¢å¤šï¼Œäº§ç”Ÿ NÃ—M ç»„åˆçˆ†ç‚¸ï¼ˆN ä¸ª Socialware Ã— M ä¸ªå¹³å°ï¼‰ï¼Œæ¯ä¸ªç»„åˆé‡å¤å®ç°ç›¸åŒçš„æ¡¥æ¥åŸºç¡€è®¾æ–½ã€‚

### ä¸ AgentForge Adapter çš„å…³ç³»

**Bridge å’Œ AgentForge Adapter æ˜¯ä¸åŒå±‚é¢çš„æŠ½è±¡ï¼Œä¸åº”åˆå¹¶ï¼š**

| ç»´åº¦ | Bridge Connector | AgentForge Adapter |
|------|-----------------|-------------------|
| æ¡¥æ¥å¯¹è±¡ | å¤–éƒ¨å¹³å°çš„ **ç”¨æˆ· + æ¶ˆæ¯** | å¤–éƒ¨ AI çš„ **æ¨ç†èƒ½åŠ›** |
| Identity è¯­ä¹‰ | å¤–éƒ¨ç”¨æˆ· â†’ Bridged Entity | LLM æ—  Identityï¼ŒAgent æ‰æœ‰ |
| æ•°æ®æµ | åŒå‘å¯¹ç­‰ï¼ˆæ¶ˆæ¯çº§ 1:1ï¼‰ | è¯·æ±‚-å“åº”ï¼ˆN:1 èšåˆï¼‰ |
| å¤–éƒ¨æœåŠ¡è§’è‰² | å¯¹ç­‰å¹³å°ï¼ˆæœ‰ç”¨æˆ·ä½“ç³»ï¼‰ | æ— çŠ¶æ€å·¥å…·ï¼ˆæä¾›è®¡ç®—ï¼‰ |

**è¾¹ç•Œæ¡ˆä¾‹â€”â€”å¤–éƒ¨ Agent å¹³å°**ï¼ˆå¦‚ LangGraph Cloudï¼‰çš„æ¨èå¤„ç†ï¼šBridge è´Ÿè´£ä¼ è¾“å±‚ï¼ˆåˆ›å»º Bridged Entityï¼‰ï¼ŒAgentForge è´Ÿè´£ç¼–æ’å±‚ï¼ˆèµ‹äºˆ Role/Flowï¼‰ã€‚ä¸¤è€…é€šè¿‡ Entity ID å’Œ EXT-13 Profile `entity_type: bridged_agent` åä½œã€‚

## Design

### D1. Bridged Entity æ¨¡å‹

å¤–éƒ¨ç”¨æˆ·åœ¨ ezagent ä¸­ä»¥ Bridged Entity èº«ä»½å­˜åœ¨ï¼š

```
Entity ID æ ¼å¼: @{connector}_{remote_id}:{relay_domain}
ç¤ºä¾‹:          @slack_U04ABCDEF:relay.example.com
               @email_bob_at_corp.com:relay.example.com
```

**èº«ä»½æ³¨å†Œ**ï¼šBridge Framework é€šè¿‡æ ‡å‡† Identity æ³¨å†Œæµç¨‹åœ¨ Relay ä¸Šåˆ›å»º Bridged Entityã€‚Bridged Entity çš„å¯†é’¥å¯¹ç”± Bridge Framework æŒæœ‰ï¼ˆä»£ç†ç­¾åï¼‰ã€‚

**Profile æ ‡è®°ï¼ˆEXT-13ï¼‰**ï¼š

```yaml
entity_type: "bridged"
ext.bridge:
  connector: "slack"                    # Connector ç±»å‹
  remote_id: "U04ABCDEF"               # å¤–éƒ¨å¹³å°ç”¨æˆ· ID
  remote_display_name: "Bob Chen"       # å¤–éƒ¨æ˜¾ç¤ºå
  remote_avatar_url: "https://..."      # å¤–éƒ¨å¤´åƒ
  bridged_by: "@bridge-svc:relay.example.com"  # Bridge æœåŠ¡ Entity
  bridged_at: "2026-03-15T08:00:00Z"   # æ¡¥æ¥æ—¶é—´
```

- [MUST] Bridged Entity çš„ `entity_type` å­—æ®µ MUST ä¸º `"bridged"`ã€‚
- [MUST] Bridged Entity çš„æ‰€æœ‰ Message MUST ç”± Bridge Framework ä»£ç†ç­¾åã€‚
- [MUST] å®¢æˆ·ç«¯ SHOULD åœ¨ UI ä¸Šå¯¹ Bridged Entity æ˜¾ç¤ºå¹³å°æ ‡è¯†ï¼ˆå¦‚ Slack å›¾æ ‡ï¼‰ã€‚

### D2. Room Config å­—æ®µ

```yaml
ext.bridge:
  routes:
    - connector: "slack"
      remote_channel: "C04XYZ789"       # Slack channel ID
      direction: "bidirectional"         # bidirectional | inbound_only | outbound_only
      filters:                           # å¯é€‰è¿‡æ»¤
        content_types: ["immutable", "mutable"]  # ä»…æ¡¥æ¥è¿™äº›ç±»å‹
        channels: ["general"]            # ä»…æ¡¥æ¥è¿™äº› ezagent channel
    - connector: "email"
      remote_channel: "dev-team@corp.com"
      direction: "outbound_only"
```

- [MUST] `ext.bridge` çš„ writer_rule: `signer.power_level >= admin`ã€‚
- [MUST] æœªå®‰è£… Bridge Extension çš„ Peer æ”¶åˆ°å« `ext.bridge` çš„ Room Config æ—¶ï¼ŒæŒ‰ Â§3.3.1 ä¿ç•™è§„åˆ™ä¿ç•™å­—æ®µã€‚

### D3. Ref Annotation

æ¡¥æ¥æ¶ˆæ¯åœ¨ Ref ä¸Šæºå¸¦æ¥æºå…ƒä¿¡æ¯ï¼š

```yaml
# Inboundï¼ˆå¤–éƒ¨â†’ezagentï¼‰çš„ Ref
ext.bridge:
  source: "slack"
  remote_message_id: "1700000000.000100"
  remote_channel: "C04XYZ789"
  remote_timestamp: "2026-03-15T08:30:00Z"

# Outboundï¼ˆezagentâ†’å¤–éƒ¨ï¼‰æˆåŠŸåçš„ Annotation å›å†™
ext.bridge:
  deliveries:
    - connector: "slack"
      remote_message_id: "1700000001.000200"
      delivered_at: "2026-03-15T08:30:05Z"
      status: "delivered"
```

- [MUST] Inbound Ref çš„ `ext.bridge.source` å­—æ®µ MUST æ ‡æ˜æ¥æº Connectorã€‚
- [MUST] Outbound delivery çŠ¶æ€ MUST é€šè¿‡ Annotation å›å†™ï¼Œä¸ä¿®æ”¹åŸå§‹ Refã€‚
- [MUST] Bridge Framework MUST ç»´æŠ¤ `remote_message_id â†” ref_id` å¹‚ç­‰æ˜ å°„ï¼Œé˜²æ­¢é‡å¤æ³¨å…¥ã€‚

### D4. Hook å®šä¹‰

| Hook | Phase | Trigger | Priority | è¯´æ˜ |
|------|-------|---------|----------|------|
| `bridge.validate_inbound` | pre_send | `ext.bridge.source != null` | 30 | éªŒè¯ inbound æ¶ˆæ¯åˆæ³•æ€§ï¼ˆç­¾åã€Bridged Entity æœ‰æ•ˆæ€§ï¼‰ |
| `bridge.route_outbound` | after_write | `timeline_index.insert` | 80 | åŒ¹é… Room Config çš„ `ext.bridge.routes`ï¼Œå¼‚æ­¥è½¬å‘åˆ°ç›®æ ‡ Connector |
| `bridge.delivery_report` | after_write | delivery å®Œæˆ | 85 | å°† delivery çŠ¶æ€å›å†™ä¸º Annotation |

**Priority è®¾è®¡ç†ç”±**ï¼š

- Inbound éªŒè¯ï¼ˆ30ï¼‰åœ¨ Identity ç­¾åéªŒè¯ï¼ˆ0ï¼‰ä¹‹åã€Socialware Hookï¼ˆâ‰¥100ï¼‰ä¹‹å‰
- Outbound è·¯ç”±ï¼ˆ80ï¼‰åœ¨æ ‡å‡† Extension Hook èŒƒå›´å†…ã€Socialware Hook ä¹‹å‰
- è¿™ç¡®ä¿ Socialware çœ‹åˆ°çš„æ¶ˆæ¯å·²ç»è¿‡ Bridge éªŒè¯å’Œæ ‡æ³¨

**after_write å¼‚æ­¥çº¦æŸ**ï¼š

- [MUST] `bridge.route_outbound` ä¸­çš„å¤–éƒ¨ API è°ƒç”¨ MUST é€šè¿‡ `tokio::spawn_blocking` å¼‚æ­¥æ‰§è¡Œï¼Œéµå¾ª bus-spec Â§3.2 çš„è§„å®šã€‚
- [MUST] å¤–éƒ¨ API è°ƒç”¨å¤±è´¥ MUST NOT å½±å“å·² apply çš„ CRDT æ•°æ®ã€‚å¤±è´¥é€šè¿‡ delivery_report Annotation è®°å½•ã€‚

### D5. Connector Plugin æ¥å£

Bridge Framework é€šè¿‡ PyO3 åŠ è½½ Python Connector Pluginï¼Œä¸ Socialware Runtime ä½¿ç”¨ç›¸åŒçš„è°ƒç”¨æœºåˆ¶ã€‚

```python
class BridgeConnector(Protocol):
    """æ¯ä¸ª Connector = ä¸€ä¸ªå¤–éƒ¨å¹³å°çš„å…¨éƒ¨æ¡¥æ¥é€»è¾‘"""

    # â”€â”€ å…ƒä¿¡æ¯ â”€â”€
    def get_meta(self) -> ConnectorMeta: ...
    def get_capabilities(self) -> set[Capability]: ...
        # Capability: TEXT, RICH_TEXT, MEDIA, REACTIONS,
        #   THREADS, PRESENCE, TYPING, READ_RECEIPTS, EDIT, DELETE

    # â”€â”€ è®¤è¯ â”€â”€
    def get_auth_flows(self) -> list[AuthFlow]: ...
    async def authenticate(self, flow_id: str,
                          credentials: dict) -> AuthSession: ...

    # â”€â”€ ç”Ÿå‘½å‘¨æœŸ â”€â”€
    async def start(self, config: ConnectorConfig,
                    sink: InboundSink) -> None: ...
    async def stop(self) -> None: ...

    # â”€â”€ Outbound â”€â”€
    async def send_message(self, target: RemoteTarget,
                          message: NormalizedMessage) -> RemoteMessageID: ...
    async def edit_message(self, remote_id: RemoteMessageID,
                          content: NormalizedMessage) -> None: ...
    async def delete_message(self, remote_id: RemoteMessageID) -> None: ...
    async def send_reaction(self, remote_id: RemoteMessageID,
                           emoji: str) -> None: ...

    # â”€â”€ Identity è§£æ â”€â”€
    async def resolve_user(self, remote_user_id: str) -> BridgedUserInfo: ...
    async def resolve_channel(self, remote_channel_id: str) -> BridgedChannelInfo: ...


@dataclass
class NormalizedMessage:
    """å¹³å°æ— å…³çš„å½’ä¸€åŒ–æ¶ˆæ¯æ ¼å¼"""
    text: str                           # çº¯æ–‡æœ¬ fallback
    rich_text: str | None = None        # Markdown
    media: list[MediaRef] = field(default_factory=list)
    reply_to: RemoteMessageID | None = None
    thread_root: RemoteMessageID | None = None
    metadata: dict = field(default_factory=dict)  # å¹³å°ç‰¹å®šé€ä¼ 


class InboundSink(Protocol):
    """Connector é€šè¿‡æ­¤æ¥å£å‘ Bridge Framework æ³¨å…¥å¤–éƒ¨äº‹ä»¶"""
    async def on_message(self, source: RemoteSource,
                        message: NormalizedMessage) -> None: ...
    async def on_edit(self, remote_id: RemoteMessageID,
                     content: NormalizedMessage) -> None: ...
    async def on_delete(self, remote_id: RemoteMessageID) -> None: ...
    async def on_reaction(self, remote_id: RemoteMessageID,
                         user: str, emoji: str) -> None: ...
    async def on_typing(self, source: RemoteSource) -> None: ...
    async def on_presence(self, user: str, status: str) -> None: ...
```

**Connector å®‰è£…è·¯å¾„**ï¼š

```
~/.ezagent/bridge-connectors/
â”œâ”€â”€ slack/
â”‚   â”œâ”€â”€ manifest.toml
â”‚   â””â”€â”€ connector.py          # å®ç° BridgeConnector
â”œâ”€â”€ email/
â”‚   â”œâ”€â”€ manifest.toml
â”‚   â””â”€â”€ connector.py
â””â”€â”€ ...
```

**manifest.toml**ï¼š

```toml
[connector]
id = "slack"
name = "Slack"
version = "0.1.0"
author = "ezagent community"
capabilities = ["TEXT", "RICH_TEXT", "MEDIA", "REACTIONS",
                "THREADS", "EDIT", "DELETE"]
auth_flows = ["oauth2", "bot_token"]

[connector.config_schema]
# JSON Schema for connector-specific config
workspace_id = { type = "string", required = true }
```

### D6. Extension å£°æ˜

```yaml
id: "bridge"
version: "0.1.0"
dependencies: ["message", "profile"]  # EXT-13 Profile for entity_type
optional_dependencies: ["mutable", "reactions", "threads", "media"]
```

ä¾èµ–å›¾ä½ç½®ï¼š

```
ç‹¬ç«‹ (ä»…ä¾èµ– Built-in + EXT-13):
    EXT-18 Bridge  â”€ depends â†’ Message, EXT-13 Profile
                   â”€ optional â†’ EXT-01 Mutable, EXT-03 Reactions,
                                EXT-10 Media, EXT-11 Threads
```

### D7. Compliance Level

å»ºè®®æ–°å¢ Levelï¼š

| å±‚çº§ | å˜æ›´ |
|------|------|
| Level 0â€“3 | ä¸å˜ |
| **Level 4: Interop** | Level 3 + EXT-18 Bridge |

æˆ–è€…å°† EXT-18 å½’å…¥ç°æœ‰ Level 3: Full ä½œä¸ºå¯é€‰é¡¹ã€‚æ­¤å†³ç­–ç•™å¾… Review é˜¶æ®µè®¨è®ºã€‚

### D8. CLI å‘½ä»¤

```bash
# Connector ç®¡ç†
ezagent bridge list-connectors           # åˆ—å‡ºå·²å®‰è£… Connector
ezagent bridge install slack             # å®‰è£… Connector
ezagent bridge uninstall slack           # å¸è½½ Connector

# Room è·¯ç”±ç®¡ç†
ezagent bridge add-route ROOM_ID \
  --connector slack \
  --remote-channel C04XYZ789 \
  --direction bidirectional

ezagent bridge remove-route ROOM_ID --connector slack
ezagent bridge list-routes ROOM_ID

# Bridged Entity ç®¡ç†
ezagent bridge list-entities              # åˆ—å‡ºæ‰€æœ‰ Bridged Entity
ezagent bridge entity-info @slack_U04ABC  # æŸ¥çœ‹è¯¦æƒ…

# è®¤è¯
ezagent bridge auth slack                 # äº¤äº’å¼è®¤è¯æµç¨‹
```

### D9. HTTP API Endpoints

| Path | Method | è¯´æ˜ |
|------|--------|------|
| `/bridge/connectors` | GET | å·²å®‰è£… Connector åˆ—è¡¨ |
| `/bridge/connectors/{id}/auth` | POST | è§¦å‘è®¤è¯æµç¨‹ |
| `/rooms/{room_id}/bridge/routes` | GET | Room çš„æ¡¥æ¥è·¯ç”± |
| `/rooms/{room_id}/bridge/routes` | PUT | æ›´æ–°æ¡¥æ¥è·¯ç”± |
| `/bridge/entities` | GET | Bridged Entity åˆ—è¡¨ |
| `/bridge/entities/{entity_id}` | GET | Bridged Entity è¯¦æƒ… |

## Impact Analysis

### å½±å“çŸ©é˜µ

| æ–‡ä»¶ | å½±å“ç¨‹åº¦ | å˜æ›´å†…å®¹ |
|------|---------|---------|
| specs/extensions-spec.md | ğŸ”´ é«˜ | æ–°å¢ Â§19 EXT-18 Bridge å®Œæ•´å®šä¹‰ï¼›Â§1.3 Compliance Level æ›´æ–°ï¼›Â§1.4 ä¾èµ–å›¾æ–°å¢ï¼›é™„å½• F/G/H æ–°å¢æ¡ç›® |
| specs/architecture.md | ğŸŸ¡ ä¸­ç­‰ | Â§0 è®¾è®¡å“²å­¦æ–°å¢ interop èƒ½åŠ›æè¿°ï¼›Â§1.3 ç½‘ç»œæ‹“æ‰‘æ–°å¢å¤–éƒ¨å¹³å°æ¡¥æ¥æ¨¡å¼å›¾ |
| specs/bus-spec.md | ğŸŸ¢ ä½ | Â§3.2 Hook æ³¨å†Œè¡¨æ–°å¢ bridge.* æ¡ç›® |
| specs/py-spec.md | ğŸŸ¡ ä¸­ç­‰ | æ–°å¢ BridgeConnector Protocol å®šä¹‰ï¼›æ–°å¢ connector åŠ è½½æœºåˆ¶ |
| specs/socialware-spec.md | ğŸŸ¢ ä½ | Â§3.2 Arena boundary è¡¥å…… bridged åœºæ™¯è¯´æ˜ |
| specs/relay-spec.md | ğŸŸ¡ ä¸­ç­‰ | Â§6 Entity ç®¡ç†è¡¥å…… Bridged Entity æ³¨å†Œç­–ç•¥ï¼›Quota ç­–ç•¥è¡¥å…… |
| products/cli-spec.md | ğŸŸ¡ ä¸­ç­‰ | æ–°å¢ `bridge` å‘½ä»¤ç»„ |
| products/http-spec.md | ğŸŸ¡ ä¸­ç­‰ | æ–°å¢ `/bridge/*` ç«¯ç‚¹ |
| products/chat-ui-spec.md | ğŸŸ¢ ä½ | Bridged Entity çš„ UI æ¸²æŸ“è§„åˆ™ï¼ˆå¹³å°å›¾æ ‡ã€badgeï¼‰ |
| products/app-prd.md | ğŸŸ¢ ä½ | Bridge ç®¡ç†ç•Œé¢æè¿° |
| plan/ | ğŸŸ¡ ä¸­ç­‰ | æ–°å¢ Phase æˆ–åœ¨ Phase 3 åè¿½åŠ  Bridge å­é˜¶æ®µ |
| socialware/agentforge-prd.md | ğŸŸ¢ ä½ | Â§4.2 è¡¥å…… BridgedAgentAdapter åä½œæè¿° |

### ä¸å—å½±å“

| æ–‡ä»¶ | åŸå›  |
|------|------|
| socialware/eventweaver-prd.md | EventWeaver æ— å¤–éƒ¨å¹³å°äº¤äº’éœ€æ±‚ |
| socialware/taskarena-prd.md | TaskArena ä½œä¸ºæ¶ˆè´¹è€…ï¼Œé€šè¿‡æ ‡å‡† API ä½¿ç”¨ Bridgeï¼Œæ— éœ€ä¿®æ”¹è‡ªèº« |
| socialware/respool-prd.md | åŒä¸Š |
| socialware/codeviber-prd.md | åŒä¸Š |

## Alternatives Considered

### A1. çº¯ Socialware å®ç°ï¼ˆä¸åŠ  Extensionï¼‰

åœ¨ Socialware å±‚å®ç°æ¡¥æ¥é€»è¾‘ï¼Œæ¯ä¸ªéœ€è¦å¤–éƒ¨äº¤äº’çš„ Socialware è‡ªè¡Œå¤„ç†ã€‚

**ä¼˜ç‚¹**ï¼šé›¶æ¶æ„å†²å‡»ã€‚

**æ”¾å¼ƒåŸå› **ï¼šNÃ—M ç»„åˆçˆ†ç‚¸ï¼›èº«ä»½æ˜ å°„æ— åè®®å±‚ä¿è¯ï¼›Hook ä¼˜å…ˆçº§åœ¨ Socialware èŒƒå›´ï¼ˆâ‰¥100ï¼‰ï¼Œæ— æ³•åœ¨ Extension å±‚ç»Ÿä¸€éªŒè¯å¤–éƒ¨æ¶ˆæ¯ï¼›è¿ååˆ†å±‚å“²å­¦ã€‚

### A2. Relay å±‚å®ç°

åœ¨ Relay æœåŠ¡ä¸­å®ç°æ¡¥æ¥ï¼Œç±»ä¼¼ Matrix çš„ Application Service æ¨¡å‹ã€‚

**ä¼˜ç‚¹**ï¼šä¸­å¿ƒåŒ–ç®¡ç†ï¼ŒBridged Entity èº«ä»½ç”± Relay ç›´æ¥æ§åˆ¶ã€‚

**æ”¾å¼ƒåŸå› **ï¼šè¿å P2P-First åŸåˆ™â€”â€”Bridge åªèƒ½åœ¨æœ‰ Relay çš„åœºæ™¯ä¸‹å·¥ä½œï¼›å¢åŠ  Relay çš„èŒè´£å’Œå¤æ‚åº¦ï¼ˆRelay è®¾è®¡åŸåˆ™æ˜¯"é‚®é€’å‘˜ï¼Œä¸æ˜¯æˆ¿ä¸œ"ï¼‰ï¼›éœ€è¦ Relay ç†è§£å¤–éƒ¨å¹³å°åè®®ï¼Œè¶…å‡ºå…¶å½“å‰çº¯ Rust æ—  Python çš„æŠ€æœ¯æ ˆã€‚

### A3. åˆå¹¶ Bridge ä¸ AgentForge Adapter ä¸ºç»Ÿä¸€æ¥å£

è®¾è®¡ä¸€ä¸ªåŒ…å« Identity æ˜ å°„å’Œ AI è°ƒç”¨çš„ç»Ÿä¸€å¤–éƒ¨æœåŠ¡æ¥å£ã€‚

**ä¼˜ç‚¹**ï¼šæ¦‚å¿µç»Ÿä¸€ã€‚

**æ”¾å¼ƒåŸå› **ï¼šè¿åæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰â€”â€”Adapter ä¸éœ€è¦ Identity æ˜ å°„å’ŒåŒå‘è·¯ç”±ï¼ŒBridge ä¸éœ€è¦ Conversation Segment å’Œ Lifecycle çŠ¶æ€æœºã€‚åˆå¹¶åæ¯ä¸ªå®ç° stub ä¸€åŠæ¥å£ã€‚ä¸¤è€…æ¡¥æ¥çš„"ä¸œè¥¿"ä¸åŒï¼ˆIdentity+Message vs Intelligenceï¼‰ï¼Œå¼ºè¡Œç»Ÿä¸€ä¼šæ¨¡ç³Šè¯­ä¹‰ã€‚

## Implementation Strategy

### ä¼˜å…ˆçº§ä¸é˜¶æ®µ

Bridge Extension **ä¸åº”è¿›å…¥ Phase 1â€“2**ã€‚å»ºè®®çš„å®æ–½æ—¶é—´çº¿ï¼š

| é˜¶æ®µ | å†…å®¹ | å‰ç½®ä¾èµ– |
|------|------|---------|
| **Pre-work** | EEP è¯„å®¡é€šè¿‡ï¼ŒSpec å®šç¨¿ | æœ¬ EEP Accepted |
| **Stage 1: Framework** | Bridge Extension Rust æ ¸å¿ƒï¼ˆHook æ³¨å†Œã€Route åŒ¹é…ã€Entity ç®¡ç†ï¼‰| Phase 2 å®Œæˆï¼ˆEXT-13 Profile å¯ç”¨ï¼‰|
| **Stage 2: Connector Interface** | Python BridgeConnector Protocol + InboundSink | Phase 3 å®Œæˆï¼ˆCLI + HTTP å¯ç”¨ï¼‰|
| **Stage 3: Reference Connector** | ä¸€ä¸ªå®Œæ•´çš„ Connector å®ç°ï¼ˆå»ºè®® Slack æˆ– Emailï¼‰ | Stage 2 |
| **Stage 4: CLI + HTTP** | `bridge` å‘½ä»¤ç»„ + REST ç«¯ç‚¹ | Stage 2 + Phase 3 |
| **Stage 5: UI** | Chat App çš„ Bridge ç®¡ç†ç•Œé¢å’Œ Bridged Entity æ¸²æŸ“ | Stage 3 + Phase 4 |

### éªŒæ”¶æ ‡å‡†

- [ ] Bridged Entity å¯åœ¨ Room ä¸­æ­£å¸¸æ˜¾ç¤ºï¼ŒUI æ ‡æ˜å¤–éƒ¨æ¥æº
- [ ] Inbound æ¶ˆæ¯é€šè¿‡å®Œæ•´ Hook Pipelineï¼Œç­¾åéªŒè¯é€šè¿‡
- [ ] Outbound æ¶ˆæ¯å¼‚æ­¥æŠ•é€’ï¼Œdelivery çŠ¶æ€å›å†™ä¸º Annotation
- [ ] Connector å®‰è£…/å¸è½½ä¸å½±å“ Bridge Framework æ ¸å¿ƒ
- [ ] è‡³å°‘ä¸€ä¸ª Reference Connectorï¼ˆSlack æˆ– Emailï¼‰é€šè¿‡é›†æˆæµ‹è¯•
- [ ] å¹‚ç­‰æ€§ï¼šé‡å¤çš„å¤–éƒ¨äº‹ä»¶ä¸äº§ç”Ÿé‡å¤ Ref

## Open Questions

### Q1. Bridged Entity çš„å¯†é’¥ç®¡ç†

Bridge Framework ä¸º Bridged Entity ä»£ç†ç­¾åã€‚å¯†é’¥å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

- **é€‰é¡¹ A**ï¼šBridge Framework çš„æœ¬åœ° keystoreï¼ˆ`~/.ezagent/bridge/keys/`ï¼‰
- **é€‰é¡¹ B**ï¼šRelay æ‰˜ç®¡å¯†é’¥ï¼ˆBridge è¯·æ±‚ Relay ä»£ç­¾ï¼‰
- **é€‰é¡¹ C**ï¼šæ¯ä¸ª Connector ç‹¬ç«‹ç®¡ç†å¯†é’¥

å€¾å‘ Aï¼Œä½†éœ€è¦è®¨è®ºå¯†é’¥è½®æ¢å’Œå¤šèŠ‚ç‚¹åŒæ­¥åœºæ™¯ã€‚

### Q2. Bridged Entity çš„ Quota ç­–ç•¥

Bridged Entity åœ¨ Relay ä¸Šæ¶ˆè€— Quota åº”å½’å±è°ï¼Ÿ

- **é€‰é¡¹ A**ï¼šå½’å±åˆ›å»º Bridge çš„ç®¡ç†å‘˜ Entity
- **é€‰é¡¹ B**ï¼šBridged Entity ç‹¬ç«‹è®¡ Quota
- **é€‰é¡¹ C**ï¼šBridge æœåŠ¡ Entity ç»Ÿä¸€è®¡ Quota

### Q3. æ¶ˆæ¯æ ¼å¼è½¬æ¢çš„ç²¾åº¦

`NormalizedMessage` æ˜¯å¦è¶³å¤Ÿè¦†ç›–ä¸»æµå¹³å°çš„æ¶ˆæ¯ç‰¹æ€§ï¼Ÿ

éœ€è¦å¯¹ Slack Block Kitã€Discord Embedã€Email MIMEã€ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯æ ¼å¼åšé€ä¸€æ˜ å°„éªŒè¯ã€‚å¯èƒ½éœ€è¦ `metadata: dict` é€ä¼ å­—æ®µæ¥ä¿ç•™æ— æ³•å½’ä¸€åŒ–çš„å¹³å°ç‰¹å®šæ•°æ®ã€‚

### Q4. Compliance Level å½’å±

EXT-18 åº”å½’å…¥ç°æœ‰ Level 3: Fullï¼Œè¿˜æ˜¯æ–°å¢ Level 4: Interopï¼Ÿ

æ–°å¢ Level çš„å¥½å¤„æ˜¯ä¸å¢åŠ  Full compliance çš„è´Ÿæ‹…ï¼›åå¤„æ˜¯å±‚çº§è¿‡å¤šå¢åŠ ç†è§£æˆæœ¬ã€‚

### Q5. ä¸ Federation çš„å…³ç³»

å½“ä¸¤ä¸ª ezagent é›†ç¾¤éœ€è¦äº’é€šæ—¶ï¼ˆè·¨ Relayï¼‰ï¼Œæ˜¯èµ° Bridge è¿˜æ˜¯èµ° Relay è”é‚¦æœºåˆ¶ï¼Ÿ

åˆæ­¥åˆ¤æ–­ï¼šåŒåè®®äº’é€šèµ° Relay è”é‚¦ï¼ˆbus-spec Â§6.5ï¼‰ï¼Œå¼‚åè®®äº’é€šèµ° Bridgeã€‚ä½†è¾¹ç•Œéœ€è¦æ˜ç¡®ã€‚

## References

- [Matrix Application Service API](https://spec.matrix.org/latest/application-service-api/)
- [Matrix Types of Bridging](https://matrix.org/docs/older/types-of-bridging/)
- [mautrix bridgev2 Architecture](https://mau.fi/blog/2024-h1-mautrix-updates/)
- [matrix-appservice-bridge](https://github.com/matrix-org/matrix-appservice-bridge)
- ezagent specs/extensions-spec.md Â§1.2 (Extension åŠ è½½è§„åˆ™)
- ezagent specs/architecture.md Â§1.3 (ç½‘ç»œæ‹“æ‰‘)
- ezagent socialware/agentforge-prd.md Â§4.2 (Adapter Protocol)

## Changelog

| æ—¥æœŸ | å˜æ›´ |
|------|------|
| 2026-02-28 | åˆå§‹ Draftã€‚åŸºäº Bridge vs AgentForge Adapter åˆ†æè®¨è®ºã€‚ |
